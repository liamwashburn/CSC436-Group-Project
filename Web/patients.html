<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Doctors Office</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <img src="https://pub-186bdf6af3664983b6d8055f39e932e8.r2.dev/dino.png" class="dino" alt="Dino">
    <div class="light-strand" id="strand"></div>
    <div id="success-toast" class="toast-container">
        <i class="fa-solid fa-circle-check"></i>
        <span>Successfull</span>
    </div>

    <div class="layout-wrapper">
        <main class="content-area">
            <h1>Patient Directory</h1>
            <div class="main-card">
                <div class="controls-header">
                    <input type="text" class="search-input" placeholder="Find patient...">
                    <button class="btn btn-primary" onclick="addNewPatient()">
                        <i class="fa-solid fa-plus"></i> New Patient
                    </button>
                </div>
                <div class="scroll-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Age</th>
                                <th>Sex</th>
                                <th>Phone</th>
                                <th>Insurance</th>
                                <th>Last Appt</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="patients-tbody">
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
        <nav class="sidebar-right">
            <a href="index.html" class="nav-btn">
                <i class="fa-regular fa-calendar-check"></i>
                Appointments
            </a>
            <a href="billing.html" class="nav-btn">
                <i class="fa-solid fa-file-invoice-dollar"></i>
                Billing
            </a>
            <a href="patients.html" class="nav-btn active">
                <i class="fa-solid fa-users"></i>
                Patients
            </a>
            <a href="rooms.html" class="nav-btn">
                <i class="fa-solid fa-door-open"></i>
                Rooms
            </a>
        </nav>
    </div>

<script src="script.js"></script>

<script>
    function showToast(message) {
        const toast = document.getElementById('success-toast');
        if (toast) {
            toast.querySelector('span').innerText = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
}
        async function fetchPatients() {
            const response = await fetch('http://127.0.0.1:8000/patients/');
            const data = await response.json();
            const patientsTbody = document.getElementById('patients-tbody');
            console.log(data);
            patientsTbody.innerHTML = '';

            data.patients.forEach(patient => {
                const tr = document.createElement('tr');
                const age = new Date().getFullYear() - new Date(patient.pDob).getFullYear();
                const insuranceClass = patient.providerName ? 'badge-success' : 'badge-warning';
                const insuranceText = patient.providerName || 'Uninsured';
                const lastAppointment = patient.LastAppointment ? patient.LastAppointment : 'None';
                const formattedLastAppointment = lastAppointment !== 'None' 
                    ? new Date(lastAppointment).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) 
                    : 'None';


                tr.innerHTML = `
                    <td><strong>${patient.pFullName}</strong></td>
                    <td>Age: ${age}</td>
                    <td>${patient.pSex}</td>
                    <td>${patient.pPhone}</td>
                    <td><span class="badge ${insuranceClass}">${insuranceText}</span></td>
                    <td>${formattedLastAppointment}</td>
                    <td>
                        <div class="btn-action-group">
                            <button class="btn btn-outline" onclick="editPatient('${patient.pID}')">Details</button>
                            <button class="btn btn-outline" onclick="MedicalRecords('${patient.pID}')">Records</button>
                        </div>
                    </td>
                `;
                patientsTbody.appendChild(tr);
            });
        }


    fetchPatients();


    function editPatient(pID) {
    window.location.href = `editpatient.html?pID=${pID}`;
    }

    function MedicalRecords(pID) {
    window.location.href = `medicalrecords.html?pID=${pID}`;
    }


    function addNewPatient() {
    window.location.href = 'addpatient.html';
    }


 </script>